export ORACLE_BASE=/data/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbtagtrig
export ORACLE_SID=neodllo

TABLESPACE=`/data/app/oracle/product/11.2.0/dbtagtrig/bin/sqlplus -silent tagtrigger/tagtri123@"(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.0.167)(PORT=1521))(CONNECT_DATA=(SID=ORCL)))" <<EOF
SET PAGESIZE 0 FEEDBACK OFF VERIFY OFF HEADING OFF ECHO OFF
SELECT /* + RULE */ DF.TABLESPACE_NAME "Tablespace",
                    DF.BYTES / (1024 * 1024) "Size(MB)",
                    SUM(FS.BYTES) / (1024 * 1024) "Free(MB)",
                    NVL(ROUND(SUM(FS.BYTES) * 100 / DF.BYTES),1) "Free",
                    ROUND((DF.BYTES - SUM(FS.BYTES)) * 100 / DF.BYTES) "Used"
FROM DBA_FREE_SPACE FS, (SELECT TABLESPACE_NAME, SUM(BYTES) BYTES FROM DBA_DATA_FILES GROUP BY TABLESPACE_NAME) DF
WHERE FS.TABLESPACE_NAME (+) = DF.TABLESPACE_NAME
GROUP BY DF.TABLESPACE_NAME,DF.BYTES
UNION ALL
SELECT /* + RULE */ DF.TABLESPACE_NAME TSPACE, FS.BYTES / (1024 * 1024),
                    SUM(DF.BYTES_FREE) / (1024 * 1024),
                    NVL(ROUND((SUM(FS.BYTES) - DF.BYTES_USED) * 100 / FS.BYTES), 1),
                    ROUND((SUM(FS.BYTES) - DF.BYTES_FREE) * 100 / FS.BYTES)
FROM DBA_TEMP_FILES FS, (SELECT TABLESPACE_NAME,BYTES_FREE,BYTES_USED FROM V\\$TEMP_SPACE_HEADER GROUP BY TABLESPACE_NAME,BYTES_FREE,BYTES_USED) DF
WHERE FS.TABLESPACE_NAME (+) = DF.TABLESPACE_NAME
GROUP BY DF.TABLESPACE_NAME,FS.BYTES,DF.BYTES_FREE,DF.BYTES_USED
ORDER BY 4 DESC;
EXIT;
EOF`

echo "$TABLESPACE"
